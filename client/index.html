
<div id="signDiv">
  Username: <input id="signDiv-username" type="text"></input><br>
  Password: <input id="signDiv-password" type="password"></input><br>
  <button id="signDiv-signIn">Sign In</button>
  <button id="signDiv-signUp">Sign Up</button>
</div>

<div id="gameDiv" style="display:none;">
  <canvas id="speedGameCanvas" width="1280" height="720"
    style="border: 1px solid #000000;"></canvas>

  <div id="chat-text" style="width: 500px; height: 100px; overflow-y:scroll">

  </div>

  <form id="chat-form">
    <input id="chat-input" type="text" style="width: 500px"></input><br>
  </form>
  <div>
    <button id="startGame">Start Game!</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>

<script>
var socket = io();
var loggedInPlayerName;
var loggedInPlayerSkillLvl;
var opponentName;
var opponentSkillLvl;

//Card Loader
var loadCount = 0;
var loadTotal = 0;
var preLoaded = false;
var cardsPileOneImgs = {};
var cardsPileTwoImgs = {};
var playerOneCards = {};
var playerTwoCards = {};
var playerOneDeck = {};
var playerTwoDeck = {};
var playerNum;


//Sign In
var signDiv = document.getElementById('signDiv');
var gameDiv = document.getElementById('gameDiv');
var signDivUsername = document.getElementById('signDiv-username');
var signDivPassword = document.getElementById('signDiv-password');
var signDivSignIn = document.getElementById('signDiv-signIn');
var signDivSignUp = document.getElementById('signDiv-signUp');

signDivSignIn.onclick = function(){
  socket.emit('signIn',{username: signDivUsername.value, password: signDivPassword.value});
}

signDivSignUp.onclick = function(){
  socket.emit('signUp',{username: signDivUsername.value, password: signDivPassword.value});
}

socket.on('signInResponse', function(data){
  if (data.success) {
    loggedInPlayerName = signDivUsername.value;
    playerNum = data.numberOfPlayers;
    signDiv.style.display = 'none';
    gameDiv.style.display = 'inline-block';
  } else {
    alert("Sign In Unsuccessful");
  }
});

socket.on('signUpResponse', function(data){
  if (data.success) {
    alert("Sign Up Sucessful")
  } else {
    alert("Sign Up Unsuccessful");
  }
});

socket.on('getSkill', function(data){
  loggedInPlayerSkillLvl = data.skillLvl;
});

//Game
//Client
var chatText = document.getElementById('chat-text');
var chatInput = document.getElementById('chat-input');
var chatForm = document.getElementById('chat-form');
var speedGameCanvas = document.getElementById('speedGameCanvas').getContext("2d");
var startGameButton = document.getElementById('startGame')

startGameButton.addEventListener('click', function(){
  socket.emit('gameStart',{startGame: true});
});

speedGameCanvas.font = '20px Arial';
speedGameCanvas.fillStyle = "white";

socket.on('newPosition',function(data){
  //speedGameCanvas.clearRect(0,0,1280,720);
   //for (var i = 0; i < data.player.length; i++)
   //{
    // speedGameCanvas.fillText(data.player[i].number,data.player[i].x, data.player[i].y);
   //}
});

socket.on('addToChat', function(data){
    chatText.innerHTML += '<div>' + data + '</div>';
    chatText.scrollTop = chatText.scrollHeight;
});

chatForm.onsubmit = function(e){
    e.preventDefault();
    if (chatInput.value != "") {
      socket.emit('sendMsgToServer', chatInput.value, loggedInPlayerName);
      chatInput.value = '';
    }
}

function loadGameBackground(){
  speedOnlineBackground = new Image();
  speedOnlineBackground.src = "/client/img/poker_table_felt.png";

  speedOnlineBackground.onload = function(){
    speedGameCanvas.drawImage(speedOnlineBackground, 0, 0);
  }
}

function loadImages(sources, callback) {
  var images = {};
  var loadedImages = 0;
  var numImages = 0;
  // get num of sources
  for(var src in sources) {
    numImages++;
  }
  for(var src in sources) {
    images[src] = new Image();
    images[src].onload = function() {
      if(++loadedImages >= numImages) {
        callback(images);
      }
    };
    images[src].src = sources[src];
  }
}

function firstPlayerPlayState(data){
  speedGameCanvas.fillText(loggedInPlayerName,20, 550);
  speedGameCanvas.fillText("Skill Level: " + loggedInPlayerSkillLvl, 20, 575);

cardsPileOneImgs = {
  cardOne : data.pileOne[0].cardBackground,
  cardTwo : data.pileOne[1].cardBackground,
  cardThree : data.pileOne[2].cardBackground,
  cardFour :data.pileOne[3].cardBackground
};

cardsPileTwoImgs = {
  cardOne : data.pileTwo[0].cardBackground,
  cardTwo : data.pileTwo[1].cardBackground,
  cardThree : data.pileTwo[2].cardBackground,
  cardFour : data.pileTwo[3].cardBackground
};

playerOneCards = {
  handCardOne : data.pOneHand[0].cardPicture,
  handCardTwo : data.pOneHand[1].cardPicture,
  handCardThree : data.pOneHand[2].cardPicture,
  handCardFour : data.pOneHand[3].cardPicture
};

playerTwoCards = {
  handCardOne : data.pTwoHand[0].cardBackground,
  handCardTwo : data.pTwoHand[1].cardBackground,
  handCardThree : data.pTwoHand[2].cardBackground,
  handCardFour : data.pTwoHand[3].cardBackground
};

loadImages(cardsPileOneImgs,function(images){
  speedGameCanvas.drawImage(images.cardOne, 100,269.25, 125, 181.5);
  speedGameCanvas.drawImage(images.cardTwo, 100,279.25, 125, 181.5);
  speedGameCanvas.drawImage(images.cardThree, 100,289.25, 125, 181.5);
  speedGameCanvas.drawImage(images.cardFour, 100,299.25, 125, 181.5);
});

loadImages(cardsPileTwoImgs,function(images){
 speedGameCanvas.drawImage(images.cardOne, 1055,269.25, 125, 181.5);
 speedGameCanvas.drawImage(images.cardTwo, 1055,279.25, 125, 181.5);
 speedGameCanvas.drawImage(images.cardThree, 1055,289.25, 125, 181.5);
 speedGameCanvas.drawImage(images.cardFour, 1055,299.25, 125, 181.5);
});

loadImages(playerOneCards,function(images){
speedGameCanvas.drawImage(images.handCardOne, 270,530, 125, 181.5);
speedGameCanvas.drawImage(images.handCardTwo, 460,530, 125, 181.5);
speedGameCanvas.drawImage(images.handCardThree, 650,530, 125, 181.5);
speedGameCanvas.drawImage(images.handCardFour, 840,530, 125, 181.5);
});

loadImages(playerTwoCards,function(images){
speedGameCanvas.drawImage(images.handCardOne, 270,8.5, 125, 181.5);
speedGameCanvas.drawImage(images.handCardTwo, 460,8.5, 125, 181.5);
speedGameCanvas.drawImage(images.handCardThree, 650,8.5, 125, 181.5);
speedGameCanvas.drawImage(images.handCardFour, 840,8.5, 125, 181.5);
});

}

function secondPlayerPlayState(data){
  speedGameCanvas.fillText(loggedInPlayerName,20, 550);
  speedGameCanvas.fillText("Skill Level: " + loggedInPlayerSkillLvl, 20, 575);

  cardsPileOneImgs = {
  cardOne : data.pileOne[0].cardBackground,
  cardTwo : data.pileOne[1].cardBackground,
  cardThree : data.pileOne[2].cardBackground,
  cardFour :data.pileOne[3].cardBackground
};

cardsPileTwoImgs = {
  cardOne : data.pileTwo[0].cardBackground,
  cardTwo : data.pileTwo[1].cardBackground,
  cardThree : data.pileTwo[2].cardBackground,
  cardFour : data.pileTwo[3].cardBackground
};

playerOneCards = {
  handCardOne : data.pOneHand[0].cardBackground,
  handCardTwo : data.pOneHand[1].cardBackground,
  handCardThree : data.pOneHand[2].cardBackground,
  handCardFour : data.pOneHand[3].cardBackground
};

playerTwoCards = {
  handCardOne : data.pTwoHand[0].cardPicture,
  handCardTwo : data.pTwoHand[1].cardPicture,
  handCardThree : data.pTwoHand[2].cardPicture,
  handCardFour : data.pTwoHand[3].cardPicture
};

loadImages(cardsPileOneImgs,function(images){
  speedGameCanvas.drawImage(images.cardOne, 100,269.25, 125, 181.5);
  speedGameCanvas.drawImage(images.cardTwo, 100,279.25, 125, 181.5);
  speedGameCanvas.drawImage(images.cardThree, 100,289.25, 125, 181.5);
  speedGameCanvas.drawImage(images.cardFour, 100,299.25, 125, 181.5);
});

loadImages(cardsPileTwoImgs,function(images){
 speedGameCanvas.drawImage(images.cardOne, 1055,269.25, 125, 181.5);
 speedGameCanvas.drawImage(images.cardTwo, 1055,279.25, 125, 181.5);
 speedGameCanvas.drawImage(images.cardThree, 1055,289.25, 125, 181.5);
 speedGameCanvas.drawImage(images.cardFour, 1055,299.25, 125, 181.5);
});

loadImages(playerOneCards,function(images){
speedGameCanvas.drawImage(images.handCardOne, 270,8.5, 125, 181.5);
speedGameCanvas.drawImage(images.handCardTwo, 460,8.5, 125, 181.5);
speedGameCanvas.drawImage(images.handCardThree, 650,8.5, 125, 181.5);
speedGameCanvas.drawImage(images.handCardFour, 840,8.5, 125, 181.5);
});

loadImages(playerTwoCards,function(images){
speedGameCanvas.drawImage(images.handCardOne, 270,530, 125, 181.5);
speedGameCanvas.drawImage(images.handCardTwo, 460,530, 125, 181.5);
speedGameCanvas.drawImage(images.handCardThree, 650,530, 125, 181.5);
speedGameCanvas.drawImage(images.handCardFour, 840,530, 125, 181.5);
});

}

function generateGameView(data){
  speedGameCanvas.fillText(loggedInPlayerName,20, 550);
  speedGameCanvas.fillText("Skill Level: " + loggedInPlayerSkillLvl, 20, 575);
    cardsPileOneImgs = {
      cardOne : data.pileOne[0].cardBackground,
      cardTwo : data.pileOne[1].cardBackground,
      cardThree : data.pileOne[2].cardBackground,
      cardFour :data.pileOne[3].cardBackground
    };

    cardsPileTwoImgs = {
      cardOne : data.pileTwo[0].cardBackground,
      cardTwo : data.pileTwo[1].cardBackground,
      cardThree : data.pileTwo[2].cardBackground,
      cardFour : data.pileTwo[3].cardBackground
    };

    playerOneCards = {
      handCardOne : data.pOneHand[0].cardPicture,
      handCardTwo : data.pOneHand[1].cardPicture,
      handCardThree : data.pOneHand[2].cardPicture,
      handCardFour : data.pOneHand[3].cardPicture
    };

    playerTwoCards = {
      handCardOne : data.pTwoHand[0].cardPicture,
      handCardTwo : data.pTwoHand[1].cardPicture,
      handCardThree : data.pTwoHand[2].cardPicture,
      handCardFour : data.pTwoHand[3].cardPicture
    };

      loadImages(cardsPileOneImgs,function(images){
        speedGameCanvas.drawImage(images.cardOne, 100,269.25, 125, 181.5);
        speedGameCanvas.drawImage(images.cardTwo, 100,279.25, 125, 181.5);
        speedGameCanvas.drawImage(images.cardThree, 100,289.25, 125, 181.5);
        speedGameCanvas.drawImage(images.cardFour, 100,299.25, 125, 181.5);
    });

     loadImages(cardsPileTwoImgs,function(images){
       speedGameCanvas.drawImage(images.cardOne, 1055,269.25, 125, 181.5);
       speedGameCanvas.drawImage(images.cardTwo, 1055,279.25, 125, 181.5);
       speedGameCanvas.drawImage(images.cardThree, 1055,289.25, 125, 181.5);
       speedGameCanvas.drawImage(images.cardFour, 1055,299.25, 125, 181.5);
  });

    loadImages(playerOneCards,function(images){
      speedGameCanvas.drawImage(images.handCardOne, 270,530, 125, 181.5);
      speedGameCanvas.drawImage(images.handCardTwo, 460,530, 125, 181.5);
      speedGameCanvas.drawImage(images.handCardThree, 650,530, 125, 181.5);
      speedGameCanvas.drawImage(images.handCardFour, 840,530, 125, 181.5);
  });

  loadImages(playerTwoCards,function(images){
    speedGameCanvas.drawImage(images.handCardOne, 270,8.5, 125, 181.5);
    speedGameCanvas.drawImage(images.handCardTwo, 460,8.5, 125, 181.5);
    speedGameCanvas.drawImage(images.handCardThree, 650,8.5, 125, 181.5);
    speedGameCanvas.drawImage(images.handCardFour, 840,8.5, 125, 181.5);
  });

}

socket.on('deckCreated',function(data){
  //speedGameCanvas.clearRect(0,0,1280,720);
  if(playerNum == 1)
    firstPlayerPlayState(data);
  if(playerNum == 2)
    secondPlayerPlayState(data);
  //generateGameView(data);
});

document.onkeydown = function(event){
  if (event.keyCode === 49) //1
    socket.emit('keyPress',{inputId: 'deckPile1', state: true});
  else if (event.keyCode === 50) //2
    socket.emit('keyPress',{inputId: 'deckPile2', state: true});
  else if (event.keyCode === 32) //SPACE
    socket.emit('keyPress',{inputId: 'drawCard', state: true});
  else if (event.keyCode === 13) //ENTER
    socket.emit('keyPress',{inputId: 'turnOver', state: true});
}

document.onkeyup = function(event){
  if (event.keyCode === 49) //1
    socket.emit('keyPress',{inputId: 'deckPile1', state: false});
  else if (event.keyCode === 50) //2
    socket.emit('keyPress',{inputId: 'deckPile2', state: false});
  else if (event.keyCode === 32) //SPACE
    socket.emit('keyPress',{inputId: 'drawCard', state: false});
  else if (event.keyCode === 13) //ENTER
    socket.emit('keyPress',{inputId: 'turnOver', state: false});
}

loadGameBackground();

</script>
